import{_ as T,u as j,a as z,s as G,r as f,L as $,o as U,R as b,G as q,b as n,c as i,g as a,e as l,k as g,t as _,n as J,l as R,F as K,f as Q,x as W}from"./index.d5019723.js";import{u as X,e as Y,b as Z,L as C,_ as ss}from"./Posts.d3fb93bc.js";import{u as as,m as es,w as ts,g as D,h as E,i as os,x as ls}from"./userStore.d171f388.js";const ns={key:0,class:"profile","data-aos":"clip-left","data-aos-duration":"1000"},is={class:"headshot"},cs=["src"],rs={class:"content"},ds={class:"head"},us={class:"name"},fs={class:"created"},_s={class:"detail"},vs={class:"max-sm:tw-mr-[50px]"},ws={class:"max-sm:tw-whitespace-nowrap max-sm:tw-ml-0"},ps={class:"post-content"},gs={key:0,class:"is-loading"},ms={key:2,class:"no-post"},hs={key:0,class:"is-loading"},ys={setup(ks){const m=j(),c=as(),x=X(),h=z(),{patchUser:F}=c,{profilePosts:v,currentPage:p,hasNext:w}=G(x),{pushProfilePosts:V,patchProfilePosts:H}=x,{openModalAlert:B}=h;v.value.length=0;const r=f(!1),O=async()=>{const{data:s}=await es();s.status==="success"&&F({_id:s.data._id,name:s.data.nickName,image:s.data.hasOwnProperty("avatar")?s.data.avatar:""})},{id:e}=m.params,d=$({_id:"",nickName:"",avatar:"",follows:[],likes:[],donatedAmount:0});(async()=>{const{data:s}=await ts(e);s.status==="success"&&Object.assign(d,s.data)})();const y=f(!0),L=async()=>{y.value=!0;const{data:s}=await D(e,m,p.value);s.status==="success"?(H(s.data.list),w.value=s.data.page.has_next):B(s.message),y.value=!1};L();const u=f([]),k=async()=>{if(c._id){u.value=[];const{data:s}=await E(c._id);if(s.status!=="success")return;F({follows:s.data.list});for(let t of c.follows)u.value.push(t.following[0]._id);u.value.findIndex(t=>t===e)>=0?r.value=!0:r.value=!1}};k(),U(async()=>{c._id||(await O(),await k())});const N=f(0),S=async()=>{const{data:s}=await E(e);s.status==="success"&&(N.value=s.data.list.length)};S(),b(()=>h.useModalFollows,async s=>{s||(await S(),await k())}),b(()=>[h.useModalPost,v],async s=>{s||await L()});const A=Y(async()=>{if(e!==c._id)if(r.value){const{data:s}=await os(e);if(s.status!=="success")return;const t=u.value.findIndex(o=>o==e);t>=0&&(u.value.splice(t,1),r.value=!1)}else{const{data:s}=await ls(e);if(s.status!=="success")return;u.value.splice(0,0,e),r.value=!0}},150),I=f(null),P=f(!0),M=async()=>{const{top:s}=I.value.getBoundingClientRect(),t=window.innerHeight;if(P.value&&s<t&&w.value){P.value=!1,p.value+=1;const{data:o}=await D(e,m,p.value);o.status==="success"?(V(o.data.list),w.value=o.data.page.has_next,P.value=!0):B(o.message)}};return U(()=>{window.addEventListener("scroll",M)}),q(()=>{window.removeEventListener("scroll",M),p.value=1,w.value=!1}),(s,t)=>(n(),i("section",null,[a(d)._id?(n(),i("div",ns,[l("div",is,[a(d).avatar?(n(),i("img",{key:0,src:a(d).avatar,alt:""},null,8,cs)):g("",!0)]),l("div",rs,[l("div",ds,[l("span",us,_(a(d).nickName),1),a(c)._id!==a(e)?(n(),i("div",{key:0,class:J(["follow-btn",r.value?"unfollow":"follow"]),onClick:t[0]||(t[0]=(...o)=>a(A)&&a(A)(...o))},_(r.value?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"),3)):g("",!0)]),l("div",fs,_(a(Z)(a(d).createdAt))+" \u52A0\u5165\u5143\u5B87\u5B99",1),l("div",_s,[l("span",null,_(a(v).length)+" \u5247\u8CBC\u6587",1),l("span",vs,_(N.value)+" \u4EBA\u8FFD\u8E64\u4E2D",1),l("span",ws,"\u5DF2\u7372\u5F97 "+_(a(d).donatedAmount)+" \u5143\u8D0A\u52A9",1)])])])):g("",!0),l("div",ps,[y.value?(n(),i("div",gs,[R(C)])):a(v).length?(n(!0),i(K,{key:1},Q(a(v),o=>(n(),W(ss,{key:o._id,post:o,"data-aos":"clip-left"},null,8,["post"]))),128)):(n(),i("div",ms," \u76EE\u524D\u5C1A\u7121\u52D5\u614B\uFF0C\u8A66\u8457\u65B0\u589E\u4E00\u5247\u52D5\u614B\u5427\uFF01 ")),l("div",{class:"loading-detector",ref_key:"loadingDetector",ref:I},[a(w)?(n(),i("div",hs,[R(C)])):g("",!0)],512)])]))}};var Ls=T(ys,[["__scopeId","data-v-7d5df810"]]);export{Ls as default};
